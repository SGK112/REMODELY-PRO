services:
  # Main Web Application (Frontend)
  - type: web
    name: remodely-web
    runtime: node
    plan: standard
    region: oregon
    buildCommand: |
      npm ci
      npx prisma generate
      npm run build
    startCommand: npm start
    autoDeploy: true
    healthCheckPath: /api/health
    domains:
      - remodely.pro
      - www.remodely.pro
    envVars:
      - key: NODE_ENV
        value: production
      - key: PORT
        value: 10000
      - key: NEXTAUTH_URL
        value: https://remodely.pro
      - key: NEXTAUTH_SECRET
        generateValue: true
      # Service URLs for inter-service communication
      - key: AUTH_SERVICE_URL
        value: https://remodely-auth.onrender.com
      - key: USER_SERVICE_URL
        value: https://remodely-users.onrender.com
      - key: QUOTE_SERVICE_URL
        value: https://remodely-quotes.onrender.com
      - key: CONTRACTOR_SERVICE_URL
        value: https://remodely-contractors.onrender.com
      - key: VOICE_SERVICE_URL
        value: https://remodely-voice.onrender.com
      - key: MATCHING_SERVICE_URL
        value: https://remodely-matching.onrender.com
      - key: SCRAPER_SERVICE_URL
        value: https://remodely-scrapers.onrender.com
      - key: LOCATION_SERVICE_URL
        value: https://remodely-location.onrender.com
      # External APIs
      - key: NEXT_PUBLIC_GOOGLE_MAPS_API_KEY
        sync: false
      - key: SERVICE_API_KEY
        generateValue: true

  # Authentication Service
  - type: web
    name: remodely-auth
    runtime: node
    plan: starter
    region: oregon
    buildCommand: |
      npm ci
      npx prisma generate
    startCommand: npm start
    autoDeploy: true
    healthCheckPath: /health
    envVars:
      - key: NODE_ENV
        value: production
      - key: PORT
        value: 10000
      - key: DATABASE_URL
        fromDatabase:
          name: remodely-auth-db
          property: connectionString
      - key: JWT_SECRET
        generateValue: true
      - key: JWT_EXPIRES_IN
        value: "24h"
      - key: TWILIO_ACCOUNT_SID
        sync: false
      - key: TWILIO_AUTH_TOKEN
        sync: false
      - key: TWILIO_PHONE_NUMBER
        sync: false
      - key: SERVICE_API_KEY
        generateValue: true
      - key: CORS_ORIGINS
        value: "https://remodely.pro,https://admin.remodely.pro"

  # User Management Service
  - type: web
    name: remodely-users
    runtime: node
    plan: starter
    region: oregon
    buildCommand: |
      npm ci
      npx prisma generate
    startCommand: npm start
    autoDeploy: true
    healthCheckPath: /health
    envVars:
      - key: NODE_ENV
        value: production
      - key: PORT
        value: 10000
      - key: DATABASE_URL
        fromDatabase:
          name: remodely-users-db
          property: connectionString
      - key: AUTH_SERVICE_URL
        value: https://remodely-auth.onrender.com
      - key: SERVICE_API_KEY
        generateValue: true
      - key: CLOUDINARY_CLOUD_NAME
        sync: false
      - key: CLOUDINARY_API_KEY
        sync: false
      - key: CLOUDINARY_API_SECRET
        sync: false

  # Quote Management Service
  - type: web
    name: remodely-quotes
    runtime: node
    plan: starter
    region: oregon
    buildCommand: |
      npm ci
      npx prisma generate
    startCommand: npm start
    autoDeploy: true
    healthCheckPath: /health
    envVars:
      - key: NODE_ENV
        value: production
      - key: PORT
        value: 10000
      - key: DATABASE_URL
        fromDatabase:
          name: remodely-quotes-db
          property: connectionString
      - key: AUTH_SERVICE_URL
        value: https://remodely-auth.onrender.com
      - key: USER_SERVICE_URL
        value: https://remodely-users.onrender.com
      - key: CONTRACTOR_SERVICE_URL
        value: https://remodely-contractors.onrender.com
      - key: MATCHING_SERVICE_URL
        value: https://remodely-matching.onrender.com
      - key: SERVICE_API_KEY
        generateValue: true

  # Contractor Management Service
  - type: web
    name: remodely-contractors
    runtime: node
    plan: starter
    region: oregon
    buildCommand: |
      npm ci
      npx prisma generate
    startCommand: npm start
    autoDeploy: true
    healthCheckPath: /health
    envVars:
      - key: NODE_ENV
        value: production
      - key: PORT
        value: 10000
      - key: DATABASE_URL
        fromDatabase:
          name: remodely-contractors-db
          property: connectionString
      - key: AUTH_SERVICE_URL
        value: https://remodely-auth.onrender.com
      - key: LOCATION_SERVICE_URL
        value: https://remodely-location.onrender.com
      - key: SERVICE_API_KEY
        generateValue: true

  # Voice AI Service
  - type: web
    name: remodely-voice
    runtime: node
    plan: standard
    region: oregon
    buildCommand: npm ci
    startCommand: npm start
    autoDeploy: true
    healthCheckPath: /health
    envVars:
      - key: NODE_ENV
        value: production
      - key: PORT
        value: 10000
      - key: AUTH_SERVICE_URL
        value: https://remodely-auth.onrender.com
      - key: ELEVENLABS_API_KEY
        sync: false
      - key: GOOGLE_CLOUD_PROJECT_ID
        sync: false
      - key: GOOGLE_CLOUD_PRIVATE_KEY
        sync: false
      - key: GOOGLE_CLOUD_CLIENT_EMAIL
        sync: false
      - key: TWILIO_ACCOUNT_SID
        sync: false
      - key: TWILIO_AUTH_TOKEN
        sync: false
      - key: SERVICE_API_KEY
        generateValue: true

  # AI Matching Service
  - type: web
    name: remodely-matching
    runtime: node
    plan: starter
    region: oregon
    buildCommand: npm ci
    startCommand: npm start
    autoDeploy: true
    healthCheckPath: /health
    envVars:
      - key: NODE_ENV
        value: production
      - key: PORT
        value: 10000
      - key: CONTRACTOR_SERVICE_URL
        value: https://remodely-contractors.onrender.com
      - key: LOCATION_SERVICE_URL
        value: https://remodely-location.onrender.com
      - key: SERVICE_API_KEY
        generateValue: true

  # Data Scraping Service
  - type: web
    name: remodely-scrapers
    runtime: node
    plan: standard
    region: oregon
    buildCommand: |
      npm ci
      npx prisma generate
    startCommand: npm start
    autoDeploy: true
    healthCheckPath: /health
    envVars:
      - key: NODE_ENV
        value: production
      - key: PORT
        value: 10000
      - key: DATABASE_URL
        fromDatabase:
          name: remodely-scrapers-db
          property: connectionString
      - key: CONTRACTOR_SERVICE_URL
        value: https://remodely-contractors.onrender.com
      - key: REDIS_URL
        fromDatabase:
          name: remodely-redis
          property: connectionString
      - key: SERVICE_API_KEY
        generateValue: true

  # Location & Maps Service
  - type: web
    name: remodely-location
    runtime: node
    plan: starter
    region: oregon
    buildCommand: npm ci
    startCommand: npm start
    autoDeploy: true
    healthCheckPath: /health
    envVars:
      - key: NODE_ENV
        value: production
      - key: PORT
        value: 10000
      - key: GOOGLE_MAPS_API_KEY
        sync: false
      - key: SERVICE_API_KEY
        generateValue: true

  # Admin Dashboard
  - type: web
    name: remodely-admin
    runtime: node
    plan: starter
    region: oregon
    buildCommand: |
      npm ci
      npm run build
    startCommand: npm start
    autoDeploy: true
    healthCheckPath: /health
    domains:
      - admin.remodely.pro
    envVars:
      - key: NODE_ENV
        value: production
      - key: PORT
        value: 10000
      # Service URLs
      - key: AUTH_SERVICE_URL
        value: https://remodely-auth.onrender.com
      - key: USER_SERVICE_URL
        value: https://remodely-users.onrender.com
      - key: QUOTE_SERVICE_URL
        value: https://remodely-quotes.onrender.com
      - key: CONTRACTOR_SERVICE_URL
        value: https://remodely-contractors.onrender.com
      - key: SCRAPER_SERVICE_URL
        value: https://remodely-scrapers.onrender.com
      - key: SERVICE_API_KEY
        generateValue: true

databases:
  # Authentication Database
  - name: remodely-auth-db
    databaseName: remodely_auth
    user: auth_user
    plan: starter

  # User Management Database  
  - name: remodely-users-db
    databaseName: remodely_users
    user: users_user
    plan: starter

  # Quote Management Database
  - name: remodely-quotes-db
    databaseName: remodely_quotes
    user: quotes_user
    plan: starter

  # Contractor Management Database
  - name: remodely-contractors-db
    databaseName: remodely_contractors
    user: contractors_user
    plan: starter

  # Scraping Data Database
  - name: remodely-scrapers-db
    databaseName: remodely_scrapers
    user: scrapers_user
    plan: starter

  # Redis Cache/Queue
  - name: remodely-redis
    plan: starter
