# Step-by-Step Selector Update Guide

## ðŸŽ¯ Example: Updating Yelp Scraper

### Step 1: Discover Current Selectors
```bash
node discover-selectors.js "https://www.yelp.com/search?find_desc=countertop+installation&find_loc=Denver,CO"
```

This will:
- Open Yelp in a browser 
- Test common selector patterns
- Show you which selectors currently work
- Keep browser open for manual inspection

### Step 2: Manual Browser Inspection
1. **Open Developer Tools** (F12 or Right-click â†’ Inspect)
2. **Find a business listing** on the page
3. **Right-click on the business name** â†’ "Inspect Element"
4. **Note the HTML structure**:
   ```html
   <!-- Example of what you might see -->
   <div class="css-1qn0b6x">
     <h3><a href="/biz/granite-works-denver">Granite Works</a></h3>
     <span class="css-1h1j0y3">(303) 555-0123</span>
     <p class="css-qgunke">123 Stone Ave, Denver, CO 80202</p>
   </div>
   ```

5. **Test selectors in browser console**:
   ```javascript
   // Test in browser console
   document.querySelectorAll('.css-1qn0b6x').length  // How many business cards?
   document.querySelectorAll('h3 a').length          // How many business names?
   ```

### Step 3: Update the Scraper File

Edit `lib/scrapers/local.ts` - Yelp section:

**BEFORE (old selectors):**
```typescript
// Wait for business listings
await page.waitForSelector('[data-testid="serp-ia-card"], .business-listing, .search-result', { timeout: 10000 })

const businessElements = await page.$$('[data-testid="serp-ia-card"], .business-listing, .search-result')
```

**AFTER (new selectors based on inspection):**
```typescript
// Wait for business listings - UPDATED SELECTORS
await page.waitForSelector('.css-1qn0b6x, [data-testid*="business"], div[class*="result"]', { timeout: 10000 })

const businessElements = await page.$$('.css-1qn0b6x, [data-testid*="business"], div[class*="result"]')
```

### Step 4: Update Data Extraction Selectors

**BEFORE:**
```typescript
const businessData = await element.evaluate((el) => {
  const nameEl = el.querySelector('.business-name, .professional-name, h3, h4')
  const locationEl = el.querySelector('.location, .pro-location')
  const phoneEl = el.querySelector('.phone, [href^="tel:"]')
  // ... rest of selectors
})
```

**AFTER:**
```typescript
const businessData = await element.evaluate((el) => {
  const nameEl = el.querySelector('h3 a, h4 a, .business-name, [data-testid*="name"]')
  const locationEl = el.querySelector('.css-qgunke, .address, [data-testid*="address"]')
  const phoneEl = el.querySelector('.css-1h1j0y3, .phone, [href^="tel:"]')
  // ... updated selectors
})
```

### Step 5: Test the Updated Scraper
```bash
node test-single-scraper.js yelp "Denver, CO"
```

This will:
- Test your updated selectors
- Show extracted data
- Keep browser open for verification

### Step 6: Test in the Full System

Update just one scraper in your system by temporarily disabling others:

```typescript
// In lib/scraper.ts - temporarily test only Yelp
private initializeScrapers() {
  this.scrapers = [
    // Comment out others for testing
    // new YellowPagesScraper(),
    new YelpScraper(), // Only test this one
    // new LocalAssociationScraper(),
  ]
}
```

Then test via admin interface or API.

## ðŸ”§ Common Selector Patterns to Try

### Business Container Selectors:
```css
/* Modern patterns */
[data-testid*="business"]
[data-testid*="result"] 
[data-testid*="card"]
div[class*="result-"]
div[class*="business-"]

/* CSS class patterns */
.css-[random-string]  /* Modern CSS-in-JS */
div[class^="css-"]
article
section

/* Generic patterns */
.result
.listing
.card
.item
```

### Business Name Selectors:
```css
h3 a
h4 a
.business-name
[data-testid*="name"]
[role="heading"] a
```

### Phone Number Selectors:
```css
[href^="tel:"]
.phone
[data-testid*="phone"]
span[class*="phone"]
```

### Address Selectors:
```css
.address
[data-testid*="address"]
.location
span[class*="address"]
p[class*="location"]
```

## ðŸš¨ Troubleshooting

### If selectors still don't work:
1. **Check for JavaScript rendering** - site might load content dynamically
2. **Look for CAPTCHA/bot detection** - site might be blocking automated access
3. **Try different user agents** - some sites block obvious bots
4. **Add longer waits** - content might load slowly
5. **Check for login requirements** - some sites require authentication

### If you see CSS classes like `.css-abc123`:
These are generated by CSS-in-JS libraries and change frequently. Look for:
- `data-testid` attributes (more stable)
- Semantic HTML elements (`article`, `section`, `h3`)
- Parent containers with stable classes

## ðŸŽ¯ Pro Tips

1. **Start with one scraper** - Don't update all at once
2. **Test frequently** - Verify each change works
3. **Use multiple fallback selectors** - `selector1, selector2, selector3`
4. **Document your changes** - Note what selectors work and when you updated them
5. **Set up monitoring** - Check scraper success rates regularly

The key is that **selector updates are normal maintenance** - websites change their HTML structure regularly, so plan to update selectors every few months.
